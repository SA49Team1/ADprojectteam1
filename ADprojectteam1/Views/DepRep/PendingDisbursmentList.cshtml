@using ADprojectteam1.Models;
@using ADprojectteam1.DB;

@{
    ViewBag.Title = "Pending Disbursement";
    Dictionary<int, int> itemlist = ViewBag.Rlist;
    

}

<h2>Pending Discursement</h2>

<input type="button" value="Confirm Received" onclick="ConfirmReceived();" />

<table>
    <tr><th>Item Name </th><th>Demand Quant</th><th>Plan to Deli Quant</th></tr>

    @{ foreach (int itemId in itemlist.Keys)
        {
            <tr>
                <td>@ItemData.GetItemById(itemId).Description</td>
                <td>@itemlist[itemId]</td>
                <td><input type="text" placeholder="Input quantity" onchange="ChangeReceive(@itemId)" size="6" id="ReceivedquantityBox @itemId" value="@itemlist[itemId]"></td>
            </tr>

        }
    }
</table>



<br>
<br>

<script>

        function ChangeReceive(itemId) {


            var q = document.getElementById("ReceivedquantityBox " + itemId).value

            var pdata = {
                itemId: itemId, quant: q
            };



            $.ajax({
                type: "POST",
                url: "/DepRep/ChangeReceiveQuant",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(pdata),
                dataType: "json",

                // Response Success
                success: function (response) {

                    alert();
                    document.getElementById("Receivedtotalq " + response.itemId).innerHTML = response.quant;

                },

                // Response Fail
                failure: function (response) {
                    alert("Fail Case");
                },

                // Response Error
                error: function (response) {
                    alert("ERROR case");
                }


            });
    }


    function ConfirmReceived() {




            var pdata = {
                
            };



            $.ajax({
                type: "POST",
                url: "/DepRep/ConfirmReceive",
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify(pdata),
                dataType: "json",

                // Response Success
                success: function (response) {

                    alert();
                    window.location.href = "./PendingDisbursmentList";

                },

                // Response Fail
                failure: function (response) {
                    alert("Fail Case");
                },

                // Response Error
                error: function (response) {
                    alert("ERROR case");
                }


            });
        }
</script>

